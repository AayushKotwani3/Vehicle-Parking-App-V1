{% extends 'user_base.html' %}

{% block title %} User Dashboard {% endblock %}

{% block content %} 
        <div class="parkinglot-table-heading-container">
                    <h2>Welcome {{ user_details.name }}</h2>                    
                </div>

        <div class="parkinglot-table-heading-container-user">
                    <h2>Search Your Spot</h2>                    
                </div>        
        
        <!-- <form class="d-flex" action="/home/{{user_details.id}}" method="POST"> -->
                <form class="d-flex" action="{{ url_for('user_dash',user_id=user_details.id) }}" method="POST">

                  <select class="form-select me-2" aria-label="Default select example" name="key" required>
                    <option selected>select</option>
                    <option value="pincode">Pincode</option>
                    <option value="location">Location</option>
                  </select>
                  <input class="form-control me-2" type="text" name="search_value" placeholder="Search" aria-label="Search" required>
                  
                  <input class="btn btn-outline-success" type="submit" value="Search">
                </form>
                
        <div class="parkinglot-table-container">
                    
                  <table class="parkinglot-table">
                        <thead>
                          <tr>
                              <th>Lot id</th>
                              <th>Location</th>
                              <th>Address</th>
                              <th>Pincode</th>
                              <th>Price</th>
                              <th>Maximum Spots</th>
                              <th>Action</th>
                          </tr>
                        </thead>
                        <tbody>
                        <!-- Looping starts here -->
                         {% for lot in parking_lot_details %}
                        <tr>
                            <td>{{lot.id}}
                            <td>{{lot.prime_location_name}}</td>
                            <td>{{lot.address}}</td>
                            <td>{{lot.pincode}}</td>
                            <td>â‚¹{{lot.price}}/hr</td>
                            <td>{{lot.maximum_spots}}</td>
                            <td class="parking-lot-table-buttons">
                                
                                 <a href="/book-parking-spot/{{user_details.id}}/{{lot.id}}"><button class="book-button">Book</button></a>
                                 
                            </td>
                        </tr>
                        {% endfor %}
                        
                            
                        
                    </tbody>
                  </table>
                  
                </div>

                <div class="parkinglot-table-heading-container-user-parkings">
                    <h2>Your Parkings</h2>                    
                </div>
                
              <div class="parkinglot-table-container">
                <table class="parkinglot-table">
                        <thead>
                          <tr>
                              <th>Spot id</th>
                              <th>Location</th>
                              <th>Address</th>
                              <th>Pincode</th>
                              <th>Vehicle number</th>
                              <th>Parking timestamp</th>
                              <!-- <th>Action</th> -->
                          </tr>
                        </thead>
                        <tbody>
                        <!-- Looping starts here -->
                         {% for records in parking_records %}
                            {% if records.status=='reserved' %}
                              <tr>
                                  <td>{{records.spot_id}}
                                  <td>{{records.spot.lot.prime_location_name}}</td>
                                  <td>{{records.spot.lot.address}}</td>
                                  <td>{{records.spot.lot.pincode}}</td>
                                  <td>{{records.vehicle_number}}</td>
                                  <td>{{records.parking_timestamp.strftime("%d-%m-%Y %I:%M %p")}}</td>
                                  <td class="parking-lot-table-buttons">
                                        
                                        <a href="/release-parking-spot/{{records.id}}"><button class="release-button">Release</button></a>
                                        
                                  </td>
                                </tr>
                            {% endif %}
                        {% endfor %} 
                        {% for records in parking_records %}
                            {% if records.status=='released' %} 
                              <tr>
                                  <td>{{records.spot_id}}
                                  <td>{{records.spot.lot.prime_location_name}}</td>
                                  <td>{{records.spot.lot.address}}</td>
                                  <td>{{records.spot.lot.pincode}}</td>
                                  <td>{{records.vehicle_number}}</td>
                                  <td>{{records.parking_timestamp.strftime("%d-%m-%Y %I:%M %p")}}</td>
                                  <td class="parking-lot-table-buttons">
                                        
                                        <a href=><button class="parked-out-button">Parked out</button></a>
                                        
                                  </td>
                                </tr>
                            {% endif %}    
                        {% endfor %}
                        
                    </tbody>
                  </table>
                  
                </div>
{% endblock %}